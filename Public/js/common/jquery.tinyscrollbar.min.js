(function(a){a.tiny=a.tiny||{};a.tiny.scrollbar={options:{axis:"y",wheel:100,scroll:true,lockscroll:true,size:"auto",sizethumb:"auto",invertscroll:false,callback:null}};a.fn.tinyscrollbar=function(d){var c=a.extend({},a.tiny.scrollbar.options,d);this.each(function(){a(this).data("tsb",new b(a(this),c))});return this};a.fn.tinyscrollbar_update=function(c){return a(this).data("tsb").update(c)};a.fn.tinyscrollbar_callback=function(c){return a(this).data("tsb").callback(c)};function b(r,g){var l=this,u=r,j={obj:a(".viewport",r)},h={obj:a(".overview",r)},d={obj:a(".scrollbar",r)},n={obj:a(".track",d.obj)},q={obj:a(".thumb",d.obj)},m=g.axis==="x",o=m?"left":"top",w=m?"Width":"Height",s=0,z={start:0,now:0},p={},e="ontouchstart" in document.documentElement,k=null;function c(){l.update();t();return l}this.update=function(A){j[g.axis]=j.obj[0]["offset"+w];h[g.axis]=h.obj[0]["scroll"+w];h.ratio=j[g.axis]/h[g.axis];d.obj.toggleClass("disable",h.ratio>=1);n[g.axis]=g.size==="auto"?j[g.axis]:g.size;q[g.axis]=Math.min(n[g.axis],Math.max(0,(g.sizethumb==="auto"?(n[g.axis]*h.ratio):g.sizethumb)));d.ratio=g.sizethumb==="auto"?(h[g.axis]/n[g.axis]):(h[g.axis]-j[g.axis])/(n[g.axis]-q[g.axis]);s=(A==="relative"&&h.ratio<=1)?Math.min((h[g.axis]-j[g.axis]),Math.max(0,s)):0;s=(A==="bottom"&&h.ratio<=1)?(h[g.axis]-j[g.axis]):isNaN(parseInt(A,10))?s:parseInt(A,10);x();this.callback()};this.callback=function(A){if(arguments.length>0&&A){k=A;return this}else{if(j[g.axis]>=h[g.axis]){d.obj.hide()}else{d.obj.show()}if(k){if(o=="top"){var B={scrollTop:s,scrollHeight:h[g.axis],clientHeight:j[g.axis]}}else{var B={scrollLeft:s,scrollWidth:h[g.axis],clientWidth:j[g.axis]}}return k(B)}}};function x(){var A=w.toLowerCase();q.obj.css(o,s/d.ratio);h.obj.css(o,-s);p.start=q.obj.offset()[o];d.obj.css(A,n[g.axis]);n.obj.css(A,n[g.axis]);q.obj.css(A,q[g.axis])}function t(){if(!e){q.obj.bind("mousedown",i);n.obj.bind("mouseup",v)}else{j.obj[0].ontouchstart=function(A){if(1===A.touches.length){i(A.touches[0]);A.stopPropagation()}}}if(g.scroll&&window.addEventListener){u[0].addEventListener("DOMMouseScroll",y,false);u[0].addEventListener("mousewheel",y,false);u[0].addEventListener("MozMousePixelScroll",function(A){A.preventDefault()},false)}else{if(g.scroll){u[0].onmousewheel=y}}}function i(B){var A=parseInt(q.obj.css(o),10);p.start=m?B.pageX:B.pageY;z.start=A=="auto"?0:A;if(!e){a(document).bind("mousemove",v);a(document).bind("mouseup",f);a(document).bind("mouseleave",f);a(document).bind("selectstart",function(){return false});q.obj.bind("mouseup",f)}else{document.ontouchmove=function(C){C.preventDefault();v(C.touches[0])};document.ontouchend=f}}function y(C){if(h.ratio<1){var B=C||window.event,A=B.wheelDelta?B.wheelDelta/120:-B.detail/3;s-=A*g.wheel;s=Math.min((h[g.axis]-j[g.axis]),Math.max(0,s));q.obj.css(o,s/d.ratio);if(o=="top"){h.obj.stop(true,true).animate({top:-s},function(){u.tinyscrollbar_callback()})}else{h.obj.stop(true,true).animate({left:-s},function(){u.tinyscrollbar_callback()})}if(g.lockscroll||(s!==(h[g.axis]-j[g.axis])&&s!==0)){B=a.event.fix(B);B.preventDefault()}}}function v(A){if(h.ratio<1){if(g.invertscroll&&e){z.now=Math.min((n[g.axis]-q[g.axis]),Math.max(0,(z.start+(p.start-(m?A.pageX:A.pageY)))))}else{z.now=Math.min((n[g.axis]-q[g.axis]),Math.max(0,(z.start+((m?A.pageX:A.pageY)-p.start))))}s=z.now*d.ratio;q.obj.css(o,z.now);h.obj.css(o,-s);u.tinyscrollbar_callback()}}function f(){a(document).unbind("mousemove",v);a(document).unbind("mouseup",f);a(document).unbind("mouseleave",f);a(document).unbind("selectstart");q.obj.unbind("mouseup",f);document.ontouchmove=document.ontouchend=null}return c()}}(jQuery));